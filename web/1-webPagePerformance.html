<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>页面性能常用办法 | Web Developer</title>
    <meta name="description" content="Web developer">
    <link rel="shortcut icon" type="icon" href="/coding/coding/images/logo/my.jpg">
    
    <link rel="preload" href="/coding/assets/css/0.styles.9a06647f.css" as="style"><link rel="preload" href="/coding/assets/js/app.bda66ca1.js" as="script"><link rel="preload" href="/coding/assets/js/2.5301b3be.js" as="script"><link rel="preload" href="/coding/assets/js/65.0d7c8758.js" as="script"><link rel="prefetch" href="/coding/assets/js/10.65e9a4bb.js"><link rel="prefetch" href="/coding/assets/js/11.9e3fd327.js"><link rel="prefetch" href="/coding/assets/js/12.45322000.js"><link rel="prefetch" href="/coding/assets/js/13.91278df4.js"><link rel="prefetch" href="/coding/assets/js/14.24d512d2.js"><link rel="prefetch" href="/coding/assets/js/15.482cbe32.js"><link rel="prefetch" href="/coding/assets/js/16.f2696b58.js"><link rel="prefetch" href="/coding/assets/js/17.4caa8eae.js"><link rel="prefetch" href="/coding/assets/js/18.c623d12e.js"><link rel="prefetch" href="/coding/assets/js/19.ad7b5a63.js"><link rel="prefetch" href="/coding/assets/js/20.effcc9e9.js"><link rel="prefetch" href="/coding/assets/js/21.2ddb2a1f.js"><link rel="prefetch" href="/coding/assets/js/22.70c9ac91.js"><link rel="prefetch" href="/coding/assets/js/23.9f5bec45.js"><link rel="prefetch" href="/coding/assets/js/24.2c097041.js"><link rel="prefetch" href="/coding/assets/js/25.ef69a840.js"><link rel="prefetch" href="/coding/assets/js/26.33c71d45.js"><link rel="prefetch" href="/coding/assets/js/27.9b42ef41.js"><link rel="prefetch" href="/coding/assets/js/28.e1cfa454.js"><link rel="prefetch" href="/coding/assets/js/29.fd9a92f3.js"><link rel="prefetch" href="/coding/assets/js/3.070fe044.js"><link rel="prefetch" href="/coding/assets/js/30.0204da64.js"><link rel="prefetch" href="/coding/assets/js/31.fa7024e0.js"><link rel="prefetch" href="/coding/assets/js/32.67999162.js"><link rel="prefetch" href="/coding/assets/js/33.96063c19.js"><link rel="prefetch" href="/coding/assets/js/34.7efda74e.js"><link rel="prefetch" href="/coding/assets/js/35.a871816e.js"><link rel="prefetch" href="/coding/assets/js/36.37f69431.js"><link rel="prefetch" href="/coding/assets/js/37.26e9bb20.js"><link rel="prefetch" href="/coding/assets/js/38.33dcec0e.js"><link rel="prefetch" href="/coding/assets/js/39.b3a3dae7.js"><link rel="prefetch" href="/coding/assets/js/4.8789dbc3.js"><link rel="prefetch" href="/coding/assets/js/40.ac4acda2.js"><link rel="prefetch" href="/coding/assets/js/41.7e49bde6.js"><link rel="prefetch" href="/coding/assets/js/42.666dbd62.js"><link rel="prefetch" href="/coding/assets/js/43.8976499b.js"><link rel="prefetch" href="/coding/assets/js/44.c241484b.js"><link rel="prefetch" href="/coding/assets/js/45.86cf049d.js"><link rel="prefetch" href="/coding/assets/js/46.f21f338c.js"><link rel="prefetch" href="/coding/assets/js/47.289d9933.js"><link rel="prefetch" href="/coding/assets/js/48.57af0318.js"><link rel="prefetch" href="/coding/assets/js/49.29d5599b.js"><link rel="prefetch" href="/coding/assets/js/5.32ebd2a0.js"><link rel="prefetch" href="/coding/assets/js/50.350b242c.js"><link rel="prefetch" href="/coding/assets/js/51.1cfc7d3f.js"><link rel="prefetch" href="/coding/assets/js/52.07abf413.js"><link rel="prefetch" href="/coding/assets/js/53.587f011d.js"><link rel="prefetch" href="/coding/assets/js/54.9bb24747.js"><link rel="prefetch" href="/coding/assets/js/55.7850accb.js"><link rel="prefetch" href="/coding/assets/js/56.d02b4a21.js"><link rel="prefetch" href="/coding/assets/js/57.099fab41.js"><link rel="prefetch" href="/coding/assets/js/58.13ce710b.js"><link rel="prefetch" href="/coding/assets/js/59.28b0136e.js"><link rel="prefetch" href="/coding/assets/js/6.a94c891c.js"><link rel="prefetch" href="/coding/assets/js/60.022fbb2c.js"><link rel="prefetch" href="/coding/assets/js/61.00fe7075.js"><link rel="prefetch" href="/coding/assets/js/62.6dc716f0.js"><link rel="prefetch" href="/coding/assets/js/63.12b12c53.js"><link rel="prefetch" href="/coding/assets/js/64.2db53cef.js"><link rel="prefetch" href="/coding/assets/js/66.010151f5.js"><link rel="prefetch" href="/coding/assets/js/67.8c86ff96.js"><link rel="prefetch" href="/coding/assets/js/7.99d9b27b.js"><link rel="prefetch" href="/coding/assets/js/8.309b23b6.js"><link rel="prefetch" href="/coding/assets/js/9.1df69252.js">
    <link rel="stylesheet" href="/coding/assets/css/0.styles.9a06647f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/coding/" class="home-link router-link-active"><img src="/coding/images/logo/my.jpg" alt="Web Developer" class="logo"> <span class="site-name can-hide">Web Developer</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/coding/vue/" class="nav-link">Vue</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Web</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/coding/css/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/coding/html/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/coding/js/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/coding/typescript/" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/coding/vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/coding/nodejs/" class="nav-link">Node.js</a></li><li class="dropdown-item"><!----> <a href="/coding/web/" class="nav-link router-link-active">Web</a></li><li class="dropdown-item"><!----> <a href="/coding/interview/" class="nav-link">Interview</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Tools</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/coding/git/" class="nav-link">Git</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">BusinessManagement</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/coding/trainer/" class="nav-link">讲师</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/hijameszhang/coding" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/coding/vue/" class="nav-link">Vue</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Web</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/coding/css/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/coding/html/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/coding/js/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/coding/typescript/" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/coding/vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/coding/nodejs/" class="nav-link">Node.js</a></li><li class="dropdown-item"><!----> <a href="/coding/web/" class="nav-link router-link-active">Web</a></li><li class="dropdown-item"><!----> <a href="/coding/interview/" class="nav-link">Interview</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Tools</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/coding/git/" class="nav-link">Git</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">BusinessManagement</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/coding/trainer/" class="nav-link">讲师</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/hijameszhang/coding" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Web Page</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/coding/web/0-xhr-options.html" class="sidebar-link">XHR 什么时候会发送options请求</a></li><li><a href="/coding/web/1-webPagePerformance.html" class="active sidebar-link">页面性能常用办法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/coding/web/1-webPagePerformance.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/coding/web/1-webPagePerformance.html#浏览器缓存" class="sidebar-link">浏览器缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/coding/web/1-webPagePerformance.html#_1-强缓存" class="sidebar-link">1. 强缓存</a></li><li class="sidebar-sub-header"><a href="/coding/web/1-webPagePerformance.html#_2-resonse-header" class="sidebar-link">2. resonse header</a></li></ul></li><li class="sidebar-sub-header"><a href="/coding/web/1-webPagePerformance.html#资源压缩-合并" class="sidebar-link">资源压缩&amp;合并</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/coding/web/1-webPagePerformance.html#_1-html压缩" class="sidebar-link">1) html压缩</a></li><li class="sidebar-sub-header"><a href="/coding/web/1-webPagePerformance.html#_2-css压缩" class="sidebar-link">2) css压缩</a></li><li class="sidebar-sub-header"><a href="/coding/web/1-webPagePerformance.html#_3-js的压缩和紊乱" class="sidebar-link">3) js的压缩和紊乱</a></li><li class="sidebar-sub-header"><a href="/coding/web/1-webPagePerformance.html#_4-文件合并" class="sidebar-link">4) 文件合并</a></li></ul></li><li class="sidebar-sub-header"><a href="/coding/web/1-webPagePerformance.html#非核心必要代码异步加载" class="sidebar-link">非核心必要代码异步加载</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/coding/web/1-webPagePerformance.html#_1-异步加载" class="sidebar-link">1) 异步加载</a></li><li class="sidebar-sub-header"><a href="/coding/web/1-webPagePerformance.html#_2-defer-async异步加载的区别" class="sidebar-link">2) defer&amp;async异步加载的区别</a></li></ul></li><li class="sidebar-sub-header"><a href="/coding/web/1-webPagePerformance.html#cdn" class="sidebar-link">CDN</a></li><li class="sidebar-sub-header"><a href="/coding/web/1-webPagePerformance.html#dns预解析" class="sidebar-link">DNS预解析</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="页面性能常用办法">页面性能常用办法</h1> <h2 id="前言">前言</h2> <div class="tip custom-block"><p class="custom-block-title">&quot;8&quot;秒准绳</p> <p>用户在访问Web网页时,</p> <ul><li>若时间超过<code>8</code>秒, 就会感觉不耐烦了.</li> <li>若加载时间太长, 用户很有可能会放弃访问.</li></ul></div> <p>大部分用户希望网页在2~3秒内完成加载. 事实上, 加载时间每多1秒, 可能会流失7%的用户, 8秒并不是确切的数据, 只是向网站开发者表明网页加载时间的重要性. 那我们应该如何页面性能, 加快页面加载速度呢?</p> <p>本文只关注一些要点, 以下是本人总结的几种常见的方法.</p> <h2 id="浏览器缓存">浏览器缓存</h2> <p>之所以把浏览器缓存放在首位, 是因为:</p> <div class="tip custom-block"><p>对于Web应用来说, 缓存是提升页面性能以及减少服务器压力的利器</p></div> <h3 id="_1-强缓存">1. 强缓存</h3> <p>不会向服务器发送请求, 直接从缓存中读取资源, 在Chrome控制台的network, 可以看到该请求的状态码为<code>200</code>, 但<code>size</code>标识为: <code>from disk cache</code>或者<code>from memory cache</code>.</p> <h3 id="_2-resonse-header">2. resonse header</h3> <h4 id="_1-expires">1) Expires</h4> <p>Expires: reponse header里的过期时间.
浏览器在再次加载该资源时, 如果在有效时间内, 则使用<strong>强缓存</strong>, 它的一个绝对时间(GMT时间字符串), 如: Expires: Thu, 21 Jan 2018 22:30:02 GMT.</p> <h4 id="_2-cache-control">2) Cache-Control</h4> <h5 id="request">request</h5> <ul><li>no-cache, 不要读取缓存中的文件, 要求向Web服务器重新请求</li> <li>no-store, 请求和响应都禁止被缓存</li> <li>max-age, 表示当访问此网页后的max-age秒内再次访问不会去服务器请求, 其功能和<code>Expires</code>类似, 只是<code>Expires</code>是根据某个特定日期做比较. 一旦缓存者自身的时间不准确, 则结果可能就是错误的, 而<code>max-age</code>显然无此问题. <code>max-age</code>的优先级高于<code>Expires</code>.</li> <li>max-stale, 允许读取过期时间必须小于<code>max-stale</code>值的缓存对象.</li> <li>min-fresh, 接受其<code>max-age</code>生命期大于其当前时间跟<code>min-fresh</code>值之和的缓存对象.</li> <li>only-if-cached, 告知缓存者, 我希望内容来自缓存, 我并不关心被缓存的响应是否是最新的.</li> <li>no-transform, 告知代理, 不要更改媒体类型, 比如jpg被改成png.</li></ul> <h5 id="response">response</h5> <ul><li>public, 数据内容均被储存起来, 就连有密码保护的网页也储存, 安全性很低.</li> <li>private, 数据内容只能被储存到私有的cache, 仅对某个用户有效, 不能共享.</li> <li>no-cache, 可以缓存, 但是只有在跟Web服务器验证了其有效后, 才能返回给客户端.</li> <li>no-store, 请求和响应都禁止被缓存</li> <li>max-age, 该响应所包含的对象的过期时间.</li> <li>must-revalidate, 如果缓存过期了, 会再次和原来的服务器确定是否为最新数据, 而不是和中间的proxy.</li> <li>max-stale, 允许读取过期时间必须小于max-stale值的缓存对象.</li> <li>proxy-revalidate, 与<code>must-revalidate</code>类似, 区别在于: <code>proxy-revalidate</code>要排除掉用户代理的缓存, 即其规则并不应用于用户代理的本地缓存上.</li> <li>s-maxage, 与<code>max-age</code>的唯一区别是<code>s-mageage</code>仅仅应用于共享缓存, 而不应用于用户代理的本地缓存等针对单用户的缓存, 另外, <code>s-maxage</code>的优先级要高于<code>max-age</code></li> <li>no-transform, 告知代理, 不要更改媒体类型, 比如jpg被改成png.</li></ul> <h4 id="_3-last-modified-if-modified-since">3) Last-Modified &amp; If-Modified-Since</h4> <p>都是用户记录页面最后修改时间的HTTP header信息, 但是:</p> <ul><li>Last-Modified 是由服务器往客户端发送的 HTTP header.</li> <li>If-Modified-Since是由客户端往服务器发送的HTTP header.</li></ul> <p>再次请求本地存在的 cache 页面时,</p> <ul><li>客户端会通过 If-Modified-Since 头将先前服务器端发过来的 Last-Modified 最后修改时间戳发送回去，这是为了让服务器端进行验证</li> <li>通过这个时间戳判断客户端的页面是否是最新的，如果不是最新的，则返回新的内容，如果是最新的，则 返回 <code>304</code> 告诉客户端其本地 <code>cache</code> 的页面是最新的，</li> <li>于是客户端就可以直接从本地加载页面了，这样在网络上传输的数据就会大大减少，同时也减轻了服务器的负担。而且在一些ajax应用中，要求获取的数据永远是最新的，而不是读取位于缓存中的数据，做这样的设置是非常有必要的。</li></ul> <p><img src="/coding/last-modified.png" alt="images.png"></p> <p>但Last-Modified存在一些缺点:</p> <ul><li>有些服务器无法获取文件最新的修改时间</li> <li>文件的修改时间变了, 但内容可能没有变化</li></ul> <p>既然按文件修改时间无法保证缓存是否合适, 那么是否可以考虑按文件内容来决定文件是否缓存呢?—-ETag和If-None-Match</p> <h4 id="_4-etag-if-none-match">4) ETag &amp; If-None-Match</h4> <p>ETag是上一次加载资源时, 服务器返回给浏览器客户端的response header, 是对该资源的一种<code>唯一标识</code>, 只要资源有变化, Etag就会重新生成, 浏览器每次加载资源向服务器发送请求时, 都会将文件上一次的Etag值放到request header的<code>If-None-Match</code>中, 服务器与客户端传入的<code>If-None-Match</code>进行比对, 看是否一致, 就能很好的断定资源是否有更新过. 若匹配, 则返回<code>HTTP 304</code>状态码, 浏览器则会直接使用本地缓存, 否则, 返回<code>HTTP 200</code>状态码, 返回最新的资源 .</p> <p><img src="/coding/etag-if-none-match.png" alt="images.png"></p> <p>Etag &amp; Last-Modified 两者比较:</p> <ul><li>从准确度来看, Etags要优于 Last-Modified, Last-Modified设置时间的最小单位是秒, 若某个文件在1秒内修改了两次或更多, Last-Modified无法精确的保证文件是否是最新的, 但Etag可以. 若是负载均衡服务器, 每个服务器生成的 Last-Modified值也可能不一致.</li> <li>从性能来看, Etag要逊于 Last-Modified, 因为 Last-Modified只需要设置时间即可, 而Etag则必须要服务器通过比对算法来比较hash值.</li></ul> <p>从优先级来看, 服务器优先考虑校验Etag</p> <h4 id="_5-cache-control">5) Cache-Control</h4> <p>浏览器缓存机制流程图</p> <p><img src="/coding/images/9890665-a04013a56dc87052.png" alt="images.png"></p> <h2 id="资源压缩-合并">资源压缩&amp;合并</h2> <p>主要包含有:</p> <ul><li>html压缩</li> <li>css压缩</li> <li>js压缩和紊乱</li> <li>文件合并
资源压缩可以从文件中去掉多余的字符, 比如回车和空格, 从而减小文件大小.</li></ul> <h3 id="_1-html压缩">1) html压缩</h3> <p>html代码压缩就是压缩这些在文本文件中有意义，可是在HTML中不需要的字符，比如: 空格，制表符，换行符等，还有一些其他意义的字符，如HTML注释也可以被压缩。</p> <h3 id="_2-css压缩">2) css压缩</h3> <p>css代码压缩简单来说就是无效代码删除和css语义合并</p> <h3 id="_3-js的压缩和紊乱">3) js的压缩和紊乱</h3> <p>如何进行js代码的压缩和紊乱呢?</p> <ul><li>使用uglifyjs2对js进行压缩</li> <li>使用在线网站进行压缩</li> <li>使用html-minifier工具</li></ul> <p>其实css压缩与js的压缩和紊乱比html压缩收益要大得多，同时css代码和js代码比html代码多得多。所以对大公司来说，html压缩无关紧要，但css压缩与js的压缩非常有必要！</p> <h3 id="_4-文件合并">4) 文件合并</h3> <p>将多个js/css小文件合并为一个文件, 减少网络请求数.</p> <h2 id="非核心必要代码异步加载">非核心必要代码异步加载</h2> <h3 id="_1-异步加载">1) 异步加载</h3> <p>实现异步加载有三种可行办法:</p> <ul><li>async</li> <li>defer</li> <li>动态创建script标签</li></ul> <h4 id="async">async</h4> <ul><li>async属性是HTML5新增属性, 目前在Chrome, Firefox, IE9+上支持.</li> <li>async的设置，会使得script脚本异步的加载并在允许的情况下执行</li> <li>async的执行，并不会按着script在页面中的顺序来执行，而是谁先加载完谁执行。</li></ul> <h4 id="defer">defer</h4> <ul><li>兼容所有浏览器</li> <li>如果script标签设置了该属性，则浏览器会异步的下载该文件并且不会影响到后续DOM的渲染；</li> <li>如果有多个设置了defer的script标签存在，则会按照顺序执行所有的script；</li> <li>defer脚本会在文档渲染完毕后，DOMContentLoaded事件调用前执行。</li></ul> <h4 id="动态创建script标签">动态创建script标签</h4> <p>在没有defer和async属性前, 异步加载是通过动态创建script标签, 在window.onload事件中触发动态创建script到dom中实现的.
示例代码:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">addScriptTag</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  script<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;type&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;text/javascript&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  script<span class="token punctuation">.</span>src <span class="token operator">=</span> src<span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">{</span>
  <span class="token function">addScriptTag</span><span class="token punctuation">(</span><span class="token string">&quot;js/index.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-defer-async异步加载的区别">2) defer&amp;async异步加载的区别</h3> <ul><li>defer是在HTML解析完之后才会实行，若是是多个，按照加载的依次实行</li> <li>async是在加载完之后立即实行，若是是多个，实行按次和加载按次无关</li></ul> <h2 id="cdn">CDN</h2> <p>CDN服务提供商会有全国各个省份部署节点, 将网站静态资源部署到CDN后, 用户在访问页面时, CDN静态资源会从就近的CDN节点上加载资源.
当请求至达CDN节点后, 节点会判断资源是缓存是否有效, 若有效, 直接返回给用户, 若无效, 会从CDN服务器加载最新的资源返回给用户同时将资源保存一份到该CDN节点上, 以便后续的访问用户使用. 因此, 只在该地区有一个用户先加载了资源, 在CDN中建立了缓存, 该地区的其他用户都能受益.</p> <h2 id="dns预解析">DNS预解析</h2> <p>DNS 作为互联网的基础协议，其解析的速度似乎容易被网站优化人员忽视。现在大多数新浏览器已经针对DNS解析进行了优化，典型的一次DNS解析耗费20-120 毫秒，减少DNS解析时间和次数是个很好的优化方式。DNS Prefetching是具有此属性的域名不需要用户点击链接就在后台解析，而域名解析和内容载入是串行的网络操作，所以这个方式能减少用户的等待时间，提升用户体验。</p> <p>预解析的实现过程：</p> <ul><li>用meta信息来告知浏览器, 当前页面要做DNS预解析: <code>&lt;meta http-equiv=&quot;x-dns-prefetch-control&quot; content=&quot;on&quot; /&gt;</code></li> <li>在页面header中使用link标签来强制对DNS预解析: <code>&lt;link rel=&quot;dns-prefetch&quot; href=&quot;http://bdimg.share.baidu.com&quot; /&gt;</code></li></ul> <blockquote><p>dns-prefetch需慎用，多页面重复DNS预解析会增加重复DNS查询次数。</p></blockquote> <div class="tip custom-block"><p>DNS预解析主要是用于网站前端页面优化，在SEO中的作用湛蓝还未作验证，但作为增强用户体验的一部分rel=&quot;dns-prefetch&quot;或许值得大家慢慢发现。</p></div> <p>浏览器对网站第一次的域名DNS解析查找流程依次为：</p> <p>浏览器缓存 -&gt; 系统缓存 -&gt; 路由器缓存 -&gt; ISP DNS缓存 -&gt; 递归搜索</p> <p><img src="/coding/dns-pefetch.png" alt="images.png"></p> <blockquote><p>Chrome内置了DNS Prefetching技术, Firefox 3.5 也引入了这一特性，由于Chrome和Firefox 3.5本身对DNS预解析做了相应优化设置，所以设置DNS预解析的不良影响之一就是可能会降低Google Chrome浏览器及火狐Firefox 3.5浏览器的用户体验。</p></blockquote> <blockquote><p>本文部分摘至网络</p></blockquote></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">7/26/2019, 10:26:43 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/coding/web/0-xhr-options.html" class="prev">
          XHR 什么时候会发送options请求
        </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/coding/assets/js/app.bda66ca1.js" defer></script><script src="/coding/assets/js/2.5301b3be.js" defer></script><script src="/coding/assets/js/65.0d7c8758.js" defer></script>
  </body>
</html>
