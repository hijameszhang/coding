<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaScript实用开发技巧 | Web Developer</title>
    <meta name="description" content="Web developer">
    <link rel="shortcut icon" type="icon" href="/coding/coding/images/logo/my.jpg">
    
    <link rel="preload" href="/coding/assets/css/0.styles.9a06647f.css" as="style"><link rel="preload" href="/coding/assets/js/app.bda66ca1.js" as="script"><link rel="preload" href="/coding/assets/js/2.5301b3be.js" as="script"><link rel="preload" href="/coding/assets/js/24.2c097041.js" as="script"><link rel="prefetch" href="/coding/assets/js/10.65e9a4bb.js"><link rel="prefetch" href="/coding/assets/js/11.9e3fd327.js"><link rel="prefetch" href="/coding/assets/js/12.45322000.js"><link rel="prefetch" href="/coding/assets/js/13.91278df4.js"><link rel="prefetch" href="/coding/assets/js/14.24d512d2.js"><link rel="prefetch" href="/coding/assets/js/15.482cbe32.js"><link rel="prefetch" href="/coding/assets/js/16.f2696b58.js"><link rel="prefetch" href="/coding/assets/js/17.4caa8eae.js"><link rel="prefetch" href="/coding/assets/js/18.c623d12e.js"><link rel="prefetch" href="/coding/assets/js/19.ad7b5a63.js"><link rel="prefetch" href="/coding/assets/js/20.effcc9e9.js"><link rel="prefetch" href="/coding/assets/js/21.2ddb2a1f.js"><link rel="prefetch" href="/coding/assets/js/22.70c9ac91.js"><link rel="prefetch" href="/coding/assets/js/23.9f5bec45.js"><link rel="prefetch" href="/coding/assets/js/25.ef69a840.js"><link rel="prefetch" href="/coding/assets/js/26.33c71d45.js"><link rel="prefetch" href="/coding/assets/js/27.9b42ef41.js"><link rel="prefetch" href="/coding/assets/js/28.e1cfa454.js"><link rel="prefetch" href="/coding/assets/js/29.fd9a92f3.js"><link rel="prefetch" href="/coding/assets/js/3.070fe044.js"><link rel="prefetch" href="/coding/assets/js/30.0204da64.js"><link rel="prefetch" href="/coding/assets/js/31.fa7024e0.js"><link rel="prefetch" href="/coding/assets/js/32.67999162.js"><link rel="prefetch" href="/coding/assets/js/33.96063c19.js"><link rel="prefetch" href="/coding/assets/js/34.7efda74e.js"><link rel="prefetch" href="/coding/assets/js/35.a871816e.js"><link rel="prefetch" href="/coding/assets/js/36.37f69431.js"><link rel="prefetch" href="/coding/assets/js/37.26e9bb20.js"><link rel="prefetch" href="/coding/assets/js/38.33dcec0e.js"><link rel="prefetch" href="/coding/assets/js/39.b3a3dae7.js"><link rel="prefetch" href="/coding/assets/js/4.8789dbc3.js"><link rel="prefetch" href="/coding/assets/js/40.ac4acda2.js"><link rel="prefetch" href="/coding/assets/js/41.7e49bde6.js"><link rel="prefetch" href="/coding/assets/js/42.666dbd62.js"><link rel="prefetch" href="/coding/assets/js/43.8976499b.js"><link rel="prefetch" href="/coding/assets/js/44.c241484b.js"><link rel="prefetch" href="/coding/assets/js/45.86cf049d.js"><link rel="prefetch" href="/coding/assets/js/46.f21f338c.js"><link rel="prefetch" href="/coding/assets/js/47.289d9933.js"><link rel="prefetch" href="/coding/assets/js/48.57af0318.js"><link rel="prefetch" href="/coding/assets/js/49.29d5599b.js"><link rel="prefetch" href="/coding/assets/js/5.32ebd2a0.js"><link rel="prefetch" href="/coding/assets/js/50.350b242c.js"><link rel="prefetch" href="/coding/assets/js/51.1cfc7d3f.js"><link rel="prefetch" href="/coding/assets/js/52.07abf413.js"><link rel="prefetch" href="/coding/assets/js/53.587f011d.js"><link rel="prefetch" href="/coding/assets/js/54.9bb24747.js"><link rel="prefetch" href="/coding/assets/js/55.7850accb.js"><link rel="prefetch" href="/coding/assets/js/56.d02b4a21.js"><link rel="prefetch" href="/coding/assets/js/57.099fab41.js"><link rel="prefetch" href="/coding/assets/js/58.13ce710b.js"><link rel="prefetch" href="/coding/assets/js/59.28b0136e.js"><link rel="prefetch" href="/coding/assets/js/6.a94c891c.js"><link rel="prefetch" href="/coding/assets/js/60.022fbb2c.js"><link rel="prefetch" href="/coding/assets/js/61.00fe7075.js"><link rel="prefetch" href="/coding/assets/js/62.6dc716f0.js"><link rel="prefetch" href="/coding/assets/js/63.12b12c53.js"><link rel="prefetch" href="/coding/assets/js/64.2db53cef.js"><link rel="prefetch" href="/coding/assets/js/65.0d7c8758.js"><link rel="prefetch" href="/coding/assets/js/66.010151f5.js"><link rel="prefetch" href="/coding/assets/js/67.8c86ff96.js"><link rel="prefetch" href="/coding/assets/js/7.99d9b27b.js"><link rel="prefetch" href="/coding/assets/js/8.309b23b6.js"><link rel="prefetch" href="/coding/assets/js/9.1df69252.js">
    <link rel="stylesheet" href="/coding/assets/css/0.styles.9a06647f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/coding/" class="home-link router-link-active"><img src="/coding/images/logo/my.jpg" alt="Web Developer" class="logo"> <span class="site-name can-hide">Web Developer</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/coding/vue/" class="nav-link">Vue</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Web</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/coding/css/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/coding/html/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/coding/js/" class="nav-link router-link-active">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/coding/typescript/" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/coding/vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/coding/nodejs/" class="nav-link">Node.js</a></li><li class="dropdown-item"><!----> <a href="/coding/web/" class="nav-link">Web</a></li><li class="dropdown-item"><!----> <a href="/coding/interview/" class="nav-link">Interview</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Tools</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/coding/git/" class="nav-link">Git</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">BusinessManagement</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/coding/trainer/" class="nav-link">讲师</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/hijameszhang/coding" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/coding/vue/" class="nav-link">Vue</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Web</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/coding/css/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/coding/html/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/coding/js/" class="nav-link router-link-active">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/coding/typescript/" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/coding/vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/coding/nodejs/" class="nav-link">Node.js</a></li><li class="dropdown-item"><!----> <a href="/coding/web/" class="nav-link">Web</a></li><li class="dropdown-item"><!----> <a href="/coding/interview/" class="nav-link">Interview</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Tools</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/coding/git/" class="nav-link">Git</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">BusinessManagement</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/coding/trainer/" class="nav-link">讲师</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/hijameszhang/coding" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>JavaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/coding/js/0-questions.html" class="sidebar-link">JavaScript 面试题</a></li><li><a href="/coding/js/1-ifElseRefactor.html" class="sidebar-link">优雅的处理if/else</a></li><li><a href="/coding/js/2-async.html" class="sidebar-link">拆解JavaScript中的异步模式</a></li><li><a href="/coding/js/3-js-skills.html" class="active sidebar-link">JavaScript实用开发技巧</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/coding/js/3-js-skills.html#尽量按强类型风格编码" class="sidebar-link">尽量按强类型风格编码</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/coding/js/3-js-skills.html#_1-变量声明时即赋值-以便知晓变量初始为什么数据类型" class="sidebar-link">1. 变量声明时即赋值, 以便知晓变量初始为什么数据类型.</a></li><li class="sidebar-sub-header"><a href="/coding/js/3-js-skills.html#_2-不可随意改变变量类型" class="sidebar-link">2. 不可随意改变变量类型</a></li><li class="sidebar-sub-header"><a href="/coding/js/3-js-skills.html#_3-函数返回类型要明确" class="sidebar-link">3. 函数返回类型要明确</a></li></ul></li><li class="sidebar-sub-header"><a href="/coding/js/3-js-skills.html#减少作用域的查找" class="sidebar-link">减少作用域的查找</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/coding/js/3-js-skills.html#_1-尽量不要让代码暴露在window-全局作用域下" class="sidebar-link">1. 尽量不要让代码暴露在window(全局作用域下)</a></li><li class="sidebar-sub-header"><a href="/coding/js/3-js-skills.html#_2-慎用闭包" class="sidebar-link">2. 慎用闭包</a></li></ul></li><li class="sidebar-sub-header"><a href="/coding/js/3-js-skills.html#_3-避免使用" class="sidebar-link">3. 避免使用==</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/coding/js/3-js-skills.html#_1-如果变量类型确定-不可使用" class="sidebar-link">1. 如果变量类型确定, 不可使用==</a></li><li class="sidebar-sub-header"><a href="/coding/js/3-js-skills.html#_2-如果变量类型不确定-尽量手动进行类型转换-避免让代码阅读者去猜测类型转换" class="sidebar-link">2. 如果变量类型不确定, 尽量手动进行类型转换, 避免让代码阅读者去猜测类型转换</a></li><li class="sidebar-sub-header"><a href="/coding/js/3-js-skills.html#_3-使用-会被eslint检查不能过" class="sidebar-link">3. 使用==会被ESlint检查不能过</a></li><li class="sidebar-sub-header"><a href="/coding/js/3-js-skills.html#_4-使用-可能会产生异外情况-从而给代码埋下隐患" class="sidebar-link">4. 使用==, 可能会产生异外情况, 从而给代码埋下隐患</a></li></ul></li><li class="sidebar-sub-header"><a href="/coding/js/3-js-skills.html#合并表达式" class="sidebar-link">合并表达式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/coding/js/3-js-skills.html#_1-用三目运算符取代简单的if-else" class="sidebar-link">1. 用三目运算符取代简单的if/else</a></li><li class="sidebar-sub-header"><a href="/coding/js/3-js-skills.html#_2-自增" class="sidebar-link">2. 自增</a></li></ul></li><li class="sidebar-sub-header"><a href="/coding/js/3-js-skills.html#减少-魔鬼变量" class="sidebar-link">减少&quot;魔鬼变量&quot;</a></li><li class="sidebar-sub-header"><a href="/coding/js/3-js-skills.html#es6使用技巧" class="sidebar-link">ES6使用技巧</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/coding/js/3-js-skills.html#_1-使用箭头函数代替匿名函数" class="sidebar-link">1. 使用箭头函数代替匿名函数</a></li><li class="sidebar-sub-header"><a href="/coding/js/3-js-skills.html#_2-class" class="sidebar-link">2. class</a></li><li class="sidebar-sub-header"><a href="/coding/js/3-js-skills.html#_3-善用模板字符" class="sidebar-link">3. 善用模板字符</a></li><li class="sidebar-sub-header"><a href="/coding/js/3-js-skills.html#_4-块级作用域变量" class="sidebar-link">4. 块级作用域变量</a></li><li class="sidebar-sub-header"><a href="/coding/js/3-js-skills.html#_5-解构赋值" class="sidebar-link">5. 解构赋值</a></li><li class="sidebar-sub-header"><a href="/coding/js/3-js-skills.html#_6-promise" class="sidebar-link">6. Promise</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="javascript实用开发技巧">JavaScript实用开发技巧</h1> <h2 id="尽量按强类型风格编码">尽量按强类型风格编码</h2> <p>JavaScript是弱类型语言, 但在编码太过随意, 也会惹出不少麻烦. 如果可以, 推荐使用TypeScript.
下面分几个典型案例讲解下</p> <h3 id="_1-变量声明时即赋值-以便知晓变量初始为什么数据类型">1. 变量声明时即赋值, 以便知晓变量初始为什么数据类型.</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// bad</span>
<span class="token keyword">var</span> numVar<span class="token punctuation">,</span> strVar<span class="token punctuation">,</span> objVar<span class="token punctuation">;</span>
</code></pre></div><blockquote><p>虽然声明了3个变量, 但JavaScript解释器并不知晓它的类型.</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// good</span>
<span class="token keyword">var</span> numVar <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> strVar <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> objVar <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>定义变量时并赋值, 会方便JavaScript解释器, 同时也增强了代码可读性, 让代码阅读者大体知道这些变量将会有什么用.</p></blockquote> <h3 id="_2-不可随意改变变量类型">2. 不可随意改变变量类型</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// bad</span>
<span class="token keyword">var</span> num <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
num <span class="token operator">=</span> <span class="token string">&quot;-&quot;</span> <span class="token operator">+</span> num<span class="token punctuation">;</span>
</code></pre></div><blockquote><p>这样会使代码阅读者增加比较大的困难, 特别是代码量比较多的情况下. 应尽量避免改变变量的类型, 如果有需要, 可以再定义一个临时变量.</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// good</span>
<span class="token keyword">var</span> num <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> tempStr <span class="token operator">=</span> <span class="token string">&quot;-&quot;</span> <span class="token operator">+</span> num<span class="token punctuation">;</span>
</code></pre></div><h3 id="_3-函数返回类型要明确">3. 函数返回类型要明确</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// bad</span>
<span class="token keyword">function</span> <span class="token function">getCount</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>count <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">return</span> count <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>函数<code>getCount</code>有可能会返回两种类型的返回值:</p> <ul><li>空字符串</li> <li>数字</li></ul> <p>虽然JavaScript允许这样写, 但这种编码风格很好, 其他人在使用这个函数时可能会比较痛苦. 如果使用者对返回值不做判断, 而直接做加减乘除法, 可能会得到NaN.</p> <p><strong>函数的返回值类型应当确定</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// good</span>
<span class="token keyword">function</span> <span class="token function">getCount</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>count <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">return</span> count <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="减少作用域的查找">减少作用域的查找</h2> <h3 id="_1-尽量不要让代码暴露在window-全局作用域下">1. 尽量不要让代码暴露在window(全局作用域下)</h3> <div class="language-html extra-class"><pre class="language-html"><code>// bad
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#canvas-warpper&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token string">&quot;600px&quot;</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token string">&quot;600px&quot;</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>上例中, 代码的上下文都是全局作用域(window).
由于全局作用域比较复杂，查找比较慢。同时也可能会污染全局变量.</p> <blockquote><p>JavaScript变量值在查找时, 优先查找当前作用域链, 如果查找不到, 会向上级作用域链中查找, 然后层层向上级查找, 最终会在全局作用域中查找, 如果实在找不到, 就会报错.</p></blockquote> <div class="language-html extra-class"><pre class="language-html"><code>// good
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#canvas-warpper&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token string">&quot;600px&quot;</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token string">&quot;600px&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这里使用到了一个自执行函数, 从而形成一个局部作用域, 以避免上例中出现的问题.  如果使用ES6编码, 可以考虑使用ES6中的块级作用域来规避上例中的问题.</p> <h3 id="_2-慎用闭包">2. 慎用闭包</h3> <p>闭包的作用在于可以让子级作用域使用它父级作用域的变量，同时这些变量在不同的闭包是不可见的。</p> <p>合理的使用闭包, 可以帮助我们解决一些麻烦的事情, 比如代码封装对外不见.</p> <p>但如果使用不当, 可以会导致在查找某个变量时, 必须要向父级作用域查找，一级一级向上查找。若闭包嵌套得很深，那查找的时间可能就很长。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getResult</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    count<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> factor <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> count <span class="token operator">*</span> factor <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上例的process函数中count变量的查找时间, 显然高于局部变量factor. 其实上例中的代码, 不太适合使用闭包, 可以考虑将count传递到process函数中:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// good</span>
<span class="token keyword">function</span> <span class="token function">getResult</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    count<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> factor <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> count <span class="token operator">*</span> factor <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">process</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>此时, count和factor两个变量的查找时间是一样的了, 都在当前作用域中直接命中. 如果一个全局变量需要经常使用, 可以考虑使用一个局部变量缓存一下.</p> <p>例如:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// bad</span>
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>protocal <span class="token operator">===</span> <span class="token string">&quot;https:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    url <span class="token operator">=</span> <span class="token string">&quot;https://example.com&quot;</span> <span class="token operator">+</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>pathname <span class="token operator">+</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>search<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>频繁地使用了window.location对象，所以可以先把它缓存一下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// good</span>
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> location <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span>protocal <span class="token operator">===</span> <span class="token string">&quot;https:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    url <span class="token operator">=</span> <span class="token string">&quot;https://example.com&quot;</span> <span class="token operator">+</span> location<span class="token punctuation">.</span>pathname <span class="token operator">+</span> location<span class="token punctuation">.</span>search<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_3-避免使用">3. 避免使用<code>==</code></h2> <p><code>==</code>和<code>===</code>有什么区别呢?</p> <ul><li><code>==</code>, 可能会对两边的数据转换, 并对值进行比较</li> <li><code>===</code>, 不会对值进行转换, 通过比较两边变量或值的引用地址, 来判断是否相等.</li></ul> <h3 id="_1-如果变量类型确定-不可使用">1. 如果变量类型确定, 不可使用<code>==</code></h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// bad</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> num <span class="token operator">!=</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// do something</span>
<span class="token punctuation">}</span> 
<span class="token keyword">var</span> num <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>num <span class="token operator">==</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// do something</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上例中变量类型都是确定的, 因此最好不用<code>==</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// good</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> num <span class="token operator">!==</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// do something</span>
<span class="token punctuation">}</span> 
<span class="token keyword">var</span> num <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>num <span class="token operator">===</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// do something</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-如果变量类型不确定-尽量手动进行类型转换-避免让代码阅读者去猜测类型转换">2. 如果变量类型不确定, 尽量手动进行类型转换, 避免让代码阅读者去猜测类型转换</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// good</span>
<span class="token keyword">var</span> totalPage <span class="token operator">=</span> <span class="token string">&quot;5&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>totalPage<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// do something</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-使用-会被eslint检查不能过">3. 使用<code>==</code>会被ESlint检查不能过</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">==</span> b<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// do something</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如下ESlint的输出：</p> <div class="language- extra-class"><pre class="language-text"><code>Expected ‘===’ and instead saw ‘==’. 
if(a == b){
</code></pre></div><h3 id="_4-使用-可能会产生异外情况-从而给代码埋下隐患">4. 使用<code>==</code>, 可能会产生异外情况, 从而给代码埋下隐患</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">null</span> <span class="token operator">==</span> <span class="token keyword">undefined</span>           <span class="token comment">//true</span>
<span class="token string">''</span> <span class="token operator">==</span> <span class="token string">'0'</span>                   <span class="token comment">//false</span>
<span class="token number">0</span>  <span class="token operator">==</span> <span class="token string">''</span>                    <span class="token comment">//true</span>
<span class="token number">0</span>  <span class="token operator">==</span> <span class="token string">'0'</span>                   <span class="token comment">//true</span>
<span class="token string">''</span> <span class="token operator">==</span> <span class="token number">0</span>                     <span class="token comment">//true</span>
<span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;abc&quot;</span>  <span class="token comment">//true</span>
<span class="token keyword">new</span> <span class="token class-name">Boolean</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">true</span>   <span class="token comment">//true</span>
<span class="token boolean">true</span> <span class="token operator">==</span> <span class="token number">1</span>                   <span class="token comment">//true</span>
</code></pre></div><p>null居然会等于undefined，因为null和undefined是两个毫无关系的值，null应该是作为初始化空值使用，而undefined是用于检验某个变量是否未定义。</p> <h2 id="合并表达式">合并表达式</h2> <h3 id="_1-用三目运算符取代简单的if-else">1. 用三目运算符取代简单的if/else</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getCount</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>count <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">return</span> count <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以改成：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getCount</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> count <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">:</span> count <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样写, 会比if/else好看多了. 但也需要注意的是, 如果if/else之类的条件判断较多或比较复杂时, 应该考虑其他方式来实现.
三目运算符应仅限于比较简单的if/else判断的场景, 不要过度使用三目运算符, 太偏了, 可能会收到不好的效果.</p> <h3 id="_2-自增">2. 自增</h3> <p>利用自增也可以简化代码。例如:</p> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span>hwit<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>msgId<span class="token operator">++</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="减少-魔鬼变量">减少&quot;魔鬼变量&quot;</h2> <p>例如，在某个文件的第xxxx行，发现有这么一段代码:</p> <div class="language-js extra-class"><pre class="language-js"><code>messageHander<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token string">&quot;seller&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;seil&quot;</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这样的代码, 很容易让人难以理解4个变量分别代码什么? 如果不去检查函数定义, 很难理解这些常量有什么用? 这些意义不明的常量, 我称之为&quot;魔鬼变量&quot;</p> <p>所以最好还是给这些常量取一个名字，特别是在一些比较关键的地方。例如上面的代码可改成：</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">var</span> sender <span class="token operator">=</span> <span class="token string">&quot;seller&quot;</span><span class="token punctuation">,</span> messageType <span class="token operator">=</span> <span class="token string">&quot;sell&quot;</span><span class="token punctuation">,</span> messageId <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> isRefreshMessageBox <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token operator">...</span>
messageHander<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> messageType<span class="token punctuation">,</span> messageId<span class="token punctuation">,</span> isRefreshMessageBox<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这样意义就很明显了。</p> <h2 id="es6使用技巧">ES6使用技巧</h2> <p>ES6已经发展很多年了，许多现代浏览器对其兼容性也已经很好了。并且webpack等打包工具会对ES6语法进行转换.</p> <p>合理的使用ES6语法，可以让代码更加地简洁。</p> <h3 id="_1-使用箭头函数代替匿名函数">1. 使用箭头函数代替匿名函数</h3> <p>有很多使用匿名函数的场景，此时用箭头函数一行, 就显得很方便了.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> nums <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
nums<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> b <span class="token operator">-</span> a<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//output: [9, 8, 4, 1, 0]</span>
</code></pre></div><p>上例如果用箭头函数的话, 代码会简洁很多：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> nums <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
nums<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token parameter">b</span> <span class="token operator">=&gt;</span> b <span class="token operator">-</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-class">2. class</h3> <p>使用ES6的class与使用function的prototype本质是一样的, 都是用原型. 但使用class会更易于进行面向对象开发.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ES5 模拟面向对象编程</span>
<span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">setName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ES6 面向对象编程</span>
<span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name
    <span class="token punctuation">}</span>

    <span class="token function">setName</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在ES6中, 可以使用class &amp; extend可以方便地实现继承、静态的成员函数，就不需要自己再去通过一些技巧去实现了。</p> <h3 id="_3-善用模板字符">3. 善用模板字符</h3> <p>善用模板字符</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// bad</span>
<span class="token keyword">var</span> temp <span class="token operator">=</span> 
    <span class="token string">'&lt;div&gt;'</span> <span class="token operator">+</span> 
    <span class="token string">'    &lt;span&gt;hello james&lt;/span&gt;'</span> <span class="token operator">+</span>
    <span class="token string">'&lt;/div&gt;'</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// good</span>
<span class="token keyword">var</span> temp <span class="token operator">=</span> 
<span class="token template-string"><span class="token string">`   &lt;div&gt;
        &lt;span&gt;hello james&lt;/span&gt;
    &lt;/div&gt;
`</span></span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// bad</span>
<span class="token keyword">var</span> username <span class="token operator">=</span> <span class="token string">'james'</span><span class="token punctuation">,</span> num <span class="token operator">=</span> <span class="token number">10</span>
<span class="token keyword">var</span> userListApi <span class="token operator">=</span> <span class="token string">&quot;/list?num=&quot;</span> <span class="token operator">+</span> num <span class="token operator">+</span> <span class="token string">&quot;&amp;username=&quot;</span> <span class="token operator">+</span> username<span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// good</span>
<span class="token keyword">var</span> userListApi <span class="token operator">=</span> <span class="token template-string"><span class="token string">`/list?num=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>num<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;username=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>username<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_4-块级作用域变量">4. 块级作用域变量</h3> <p>块级作用域变量是ES6的一个特色. 有了块级作用域, 就方便很多了.</p> <p>下面的代码是一个任务队列的模型抽象：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> tasks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    tasks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;i is &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> tasks<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    tasks<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>但是上面代码的执行输出是4，4，4，4，并不是想要输出：0，1，2，3
所以每个task就不能取到它的index了，这是因为闭包都是用的同一个i变量，i已经变成4了，所以执行闭包的时候就都是4了。那怎么办呢？可以这样解决：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> tasks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token operator">!</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">k</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        tasks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;i is &quot;</span> <span class="token operator">+</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> tasks<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    tasks<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>把i赋值给了k，由于k它是一个function的一个参数，每次执行函数的时候，肯定会实例化新的k，所以每次的k都是不同的变量，这样就输出就正常了。</p> <p>如果用ES6，实现起来就简单很多了! 只要把<code>var</code>改成<code>let</code>就行, 因为有块级作用域.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> tasks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    tasks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;i is &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> tasks<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    tasks<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-解构赋值">5. 解构赋值</h3> <h4 id="_1-基础使用">1) 基础使用</h4> <p>在ES6中新增解构赋值的语法, 解决了很多在变量赋值时的麻烦.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ES5</span>
<span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> s<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// good</span>
<span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span>first<span class="token punctuation">,</span> second<span class="token punctuation">}</span> <span class="token operator">=</span> s
</code></pre></div><h4 id="_2-使用默认值">2) 使用默认值</h4> <p>如果想按强类型的语法来编写, 可以考虑给<code>first</code>给一个默认值, 如果没有取到值, 就使用默认值.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// good</span>
<span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span>first <span class="token operator">=</span> <span class="token function">paramRequired</span><span class="token punctuation">(</span><span class="token string">'first'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> second <span class="token operator">=</span> <span class="token function">paramRequired</span><span class="token punctuation">(</span><span class="token string">'second'</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">=</span> s

<span class="token keyword">function</span> <span class="token function">paramRequired</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Param: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is required!`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-解构赋值时使用别名">3) 解构赋值时使用别名</h4> <p>在解构赋值时, 也可以使用不同变量赋值</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> element <span class="token operator">=</span> <span class="token punctuation">{</span>
    tag <span class="token punctuation">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
    text <span class="token punctuation">:</span> <span class="token string">'hello james'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span>tag<span class="token punctuation">:</span>localTag<span class="token punctuation">,</span>text<span class="token punctuation">:</span>localText<span class="token punctuation">}</span> <span class="token operator">=</span> element<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>localTag<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//'div'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>localText<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//'hello james'</span>
</code></pre></div><h4 id="_4-嵌套对象-数组中的提取">4) 嵌套对象/数组中的提取</h4> <p>如果对象嵌套层次较多, 也可以深入到嵌套的对象结构中提取想要的数据</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> element <span class="token operator">=</span> <span class="token punctuation">{</span>
    tag<span class="token punctuation">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
    text<span class="token punctuation">:</span> <span class="token string">'hello james'</span><span class="token punctuation">,</span>
    attrs<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        dataIndex<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        userInfo<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            name<span class="token punctuation">:</span> <span class="token string">'jameszhang'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span> attrs<span class="token punctuation">:</span> <span class="token punctuation">{</span> userInfo<span class="token punctuation">:</span>userIdenInfo <span class="token operator">=</span> <span class="token function">paramRequired</span><span class="token punctuation">(</span><span class="token string">'userIdenInfo'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">=</span> element<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>userIdenInfo<span class="token punctuation">.</span>name<span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">paramRequired</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Param: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is required!`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果上例中的<code>userInfo</code>的值为undefined, 则会触发paramRequired函数的执行, 最终会给出一个出错提示.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token constant">VM1642</span><span class="token punctuation">:</span><span class="token number">12</span> Uncaught Error<span class="token punctuation">:</span> Param<span class="token punctuation">:</span> userIdenInfo is required<span class="token operator">!</span>
    at <span class="token function">paramRequired</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>anonymous<span class="token operator">&gt;</span><span class="token punctuation">:</span><span class="token number">12</span><span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">)</span>
    at <span class="token operator">&lt;</span>anonymous<span class="token operator">&gt;</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token number">40</span>
</code></pre></div><p>同样的, 如果是一个多维数组, 可以通过深入到嵌套的数组结构中取得想要的数据.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> colors <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token string">&quot;green&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lightgreen&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;blue&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token punctuation">[</span>first<span class="token punctuation">,</span> <span class="token punctuation">[</span>second<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> colors
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>second<span class="token punctuation">)</span> <span class="token comment">// output: green</span>
</code></pre></div><h4 id="_5-数组剩余项赋值">5) 数组剩余项赋值</h4> <p>数组解构有个与函数的剩余参数类似的, 名为剩余项（ rest items ）的概
念，它使用<code>...</code>语法来将剩余的项目赋值给一个指定的变量</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> colors <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;green&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;blue&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token punctuation">[</span> firstColor<span class="token punctuation">,</span> <span class="token operator">...</span>restColors <span class="token punctuation">]</span> <span class="token operator">=</span> colors<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>firstColor<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;red&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>restColors<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>restColors<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;green&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>restColors<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;blue&quot;</span>
</code></pre></div><h4 id="_6-混合解构">6) 混合解构</h4> <p>对象中包含有多种数据类型, 如包含有: 数组, 对象, 函数等等. 例如</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> vnode <span class="token operator">=</span> <span class="token punctuation">{</span>
    tag<span class="token punctuation">:</span> <span class="token string">'user-info'</span><span class="token punctuation">,</span>
    text<span class="token punctuation">:</span> <span class="token string">'hello james'</span><span class="token punctuation">,</span>
    attrs<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        ref<span class="token punctuation">:</span> <span class="token string">'userId'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            tag<span class="token punctuation">:</span> <span class="token string">'user-name'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            tag<span class="token punctuation">:</span> <span class="token string">'user-profile'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span>attrs<span class="token punctuation">:</span> <span class="token punctuation">{</span>ref<span class="token punctuation">}</span><span class="token punctuation">,</span> children<span class="token punctuation">:</span> <span class="token punctuation">[</span>first<span class="token punctuation">,</span> second<span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token operator">=</span> vnode
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> first<span class="token punctuation">.</span>tag<span class="token punctuation">,</span> second<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token comment">// output: userId user-name user-profile</span>
</code></pre></div><h4 id="_7-函数参数解析">7) 函数参数解析</h4> <p>如果上例中的vnode作为函数的参数传入使用, 也可以考虑使用解构赋值来实现. 例如:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">handleNode</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>attrs<span class="token punctuation">:</span> <span class="token punctuation">{</span>ref<span class="token punctuation">}</span><span class="token punctuation">,</span> children<span class="token punctuation">:</span> <span class="token punctuation">[</span>firstChild<span class="token punctuation">,</span> secondChild<span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> firstChild<span class="token punctuation">,</span> secondChild<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">handleNode</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>
</code></pre></div><h3 id="_6-promise">6. Promise</h3> <p>// todo</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">9/25/2019, 7:28:41 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/coding/js/2-async.html" class="prev">
          拆解JavaScript中的异步模式
        </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/coding/assets/js/app.bda66ca1.js" defer></script><script src="/coding/assets/js/2.5301b3be.js" defer></script><script src="/coding/assets/js/24.2c097041.js" defer></script>
  </body>
</html>
